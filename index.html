<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>給妳的歌</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --text: #f8fafc;
      --muted: rgba(248,250,252,.72);
      --accent: #ff67b3;
      --accent2:#6aa7ff;
      --border: rgba(255,255,255,.12);
      --shadow: 0 30px 90px rgba(0,0,0,.55);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
      font-family: system-ui, -apple-system, "Segoe UI", "Noto Sans TC", sans-serif;
      background:
        radial-gradient(1100px 700px at 15% 20%, rgba(255,103,179,.18), transparent 60%),
        radial-gradient(1100px 700px at 85% 25%, rgba(106,167,255,.18), transparent 60%),
        radial-gradient(1200px 900px at 50% 100%, rgba(255,255,255,.06), transparent 55%),
        linear-gradient(180deg, #070a12, var(--bg));
      color: var(--text);
      overflow:hidden;
    }

    .wrap{width:min(700px, 100%); position:relative; z-index:2;}
    .card{
      position:relative;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), var(--card2));
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:18px;
      overflow:hidden;
    }

    /* 標頭 */
    .top{display:flex; justify-content:space-between; gap:12px; align-items:flex-start;}
    .title{display:flex; flex-direction:column; gap:6px;}
    h1{margin:0; font-size:20px; letter-spacing:.4px}
    .sub{color:var(--muted); font-size:13.5px; line-height:1.6; min-height:42px}

    /* 跳字動畫 */
    .popline{display:inline-block; white-space:pre-wrap}
    .ch{
      display:inline-block;
      transform: translateY(10px) scale(.98);
      opacity:0;
      filter: blur(1px);
      animation: pop .55s ease forwards;
    }
    @keyframes pop{
      to{transform: translateY(0) scale(1); opacity:1; filter: blur(0)}
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: rgba(248,250,252,.85);
      font-size:12.5px;
      white-space:nowrap;
    }
    .dot{
      width:9px; height:9px; border-radius:999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(255,103,179,.12);
    }

    /* 控制列 */
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    button{
      flex:1 1 160px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      font-size:15px;
      font-weight:750;
      color:#0b0f1a;
      background: linear-gradient(135deg, #ffd1e8, #ff67b3 40%, #7fb0ff);
      box-shadow: 0 14px 28px rgba(255,103,179,.18);
      transition: transform .08s ease, filter .12s ease;
    }
    button:hover{filter:brightness(1.02)}
    button:active{transform: translateY(1px)}
    .ghost{
      flex:0 0 auto;
      background: rgba(255,255,255,.06);
      color: rgba(248,250,252,.92);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
      font-weight:750;
    }

    /* 錯誤提示 */
    .err{
      display:none;
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,103,179,.12);
      border:1px solid rgba(255,103,179,.18);
      color:#ffd1e8;
      font-size:13px;
      line-height:1.5;
    }

    audio{width:100%; margin-top:12px; border-radius:14px;}

    /* 字幕 */
    .capWrap{
      margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      padding:14px;
    }
    .capTop{
      display:flex; justify-content:space-between; align-items:center;
      color: rgba(248,250,252,.72);
      font-size:12.5px;
      margin-bottom:10px;
    }
    .caps{min-height:78px; font-size:16px; line-height:1.85}
    .capLine{
      opacity:.40;
      transform: translateY(0);
      transition: opacity .12s ease, transform .12s ease;
      text-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .capLine.active{
      opacity:1;
      transform: translateY(-1px);
    }
    .hint{margin-top:10px; text-align:center; color: rgba(248,250,252,.62); font-size:12.5px}

    /* 兩張圖亂跑（在背景層） */
    .playfield{
      position:fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
      overflow:hidden;
    }
    .runner{
      position:absolute;
      width:86px;
      height:auto;
      opacity:.95;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.45));
      transform: translate3d(0,0,0);
      user-select:none;
    }
    .runner.flip{transform: scaleX(-1);}
    /* 讓圖更可愛：輕微晃動 */
    .runner.bob{animation: bob 1.1s ease-in-out infinite;}
    @keyframes bob{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-6px)}
    }
  </style>
</head>

<body>
  <!-- 亂跑的兩張圖 -->
  <div class="playfield" id="playfield">
    <img class="runner bob" id="r1" src="img/run1.png" alt="">
    <img class="runner bob" id="r2" src="img/run2.png" alt="">
  </div>

  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="title">
          <h1 id="title">給妳的歌</h1>
          <div class="sub" id="lead"></div>
        </div>
        <div class="badge"><span class="dot"></span><span id="slot">載入中</span></div>
      </div>

      <div class="controls">
        <button id="playBtn">播放</button>
        <button class="ghost" id="reloadBtn">重新載入</button>
      </div>

      <div class="err" id="err"></div>

      <audio id="player" controls preload="auto"></audio>

      <div class="capWrap">
        <div class="capTop">
          <span>字幕</span>
          <span id="timeTag">00:00</span>
        </div>
        <div class="caps" id="caps"></div>
      </div>

      <div class="hint">提示：手機通常需要你點一次「播放」才能出聲（瀏覽器限制）。</div>
    </div>
  </div>

<script>
  /** ====== 可自訂區：四時段歌名、訊息、字幕 ====== */
  const CFG = {
    title: "給妳的歌",
    slots: {
      morning: {
        label: "早上",
        message: "今天慢慢來。",
        song: "audio/morning_song.mp3",
        captions: [
          { t: 0,  text: "早上的風 有一點涼" },
          { t: 6,  text: "不用太快 也不用趕" },
          { t: 12, text: "今天的路 慢慢走完" },
          { t: 18, text: "如果妳笑 那就很好" }
        ]
      },
      day: {
        label: "白天",
        message: "上班很辛苦，能上就上；無聊就吃吃喝喝。有我陪你。",
        song: "audio/day_song.mp3",
        captions: [
          { t: 0,  text: "上班很辛苦" },
          { t: 4,  text: "能撐就撐" },
          { t: 9,  text: "不想撐的時候 也沒關係" },
          { t: 14, text: "無聊就吃吃喝喝" },
          { t: 19, text: "不用想太多 也不用急" },
          { t: 24, text: "有我陪你 慢慢過去" }
        ]
      },
      evening: {
        label: "晚上",
        message: "辛苦了，今天就到這裡。",
        song: "audio/evening_song.mp3",
        captions: [
          { t: 0,  text: "燈一盞一盞 亮起來" },
          { t: 7,  text: "一天的聲音 慢慢離開" },
          { t: 14, text: "妳今天 真的很棒" },
          { t: 20, text: "不用趕路 不用想" }
        ]
      },
      night: {
        label: "深夜",
        message: "如果你還醒著，我在。",
        song: "audio/day_song.mp3",
        captions: [
          { t: 0,  text: "如果妳 還醒著" },
          { t: 5,  text: "那也沒關係" },
          { t: 10, text: "夜很長 但不孤單" },
          { t: 16, text: "我在這裡 陪妳一下" }
        ]
      }
    }
  };

  /** ====== 工具：跳字動畫 ====== */
  function animateText(el, text){
    el.innerHTML = "";
    const span = document.createElement("span");
    span.className = "popline";
    Array.from(text).forEach((c,i)=>{
      const s = document.createElement("span");
      s.className="ch";
      s.style.animationDelay = (i*0.03)+"s";
      s.textContent=c;
      span.appendChild(s);
    });
    el.appendChild(span);
  }

  /** ====== 工具：字幕 ====== */
  function fmtTime(sec){
    sec = Math.max(0, Math.floor(sec));
    const m = String(Math.floor(sec/60)).padStart(2,"0");
    const s = String(sec%60).padStart(2,"0");
    return `${m}:${s}`;
  }
  function renderCaptions(container, captions){
    container.innerHTML="";
    captions.forEach((c, idx)=>{
      const div=document.createElement("div");
      div.className="capLine";
      div.dataset.idx=String(idx);
      div.textContent=c.text;
      container.appendChild(div);
    });
  }
  function updateActiveCaption(container, captions, t){
    let active=-1;
    for(let i=0;i<captions.length;i++){
      if(t >= captions[i].t) active=i; else break;
    }
    const nodes=container.querySelectorAll(".capLine");
    nodes.forEach((n,i)=>{
      n.classList.toggle("active", i===active);
      // 只顯示附近幾行
      if(active === -1) n.style.display = (i < 4 ? "" : "none");
      else n.style.display = (Math.abs(i-active)<=2 ? "" : "none");
    });
  }

  /** ====== 時段選擇 ====== */
  function pickSlot(){
    const h = new Date().getHours();
    if(h>=6 && h<11) return "morning";
    if(h>=11 && h<18) return "day";
    if(h>=18 && h<23) return "evening";
    return "night";
  }

  /** ====== DOM ====== */
  const titleEl = document.getElementById("title");
  const leadEl  = document.getElementById("lead");
  const slotEl  = document.getElementById("slot");
  const errEl   = document.getElementById("err");
  const player  = document.getElementById("player");
  const playBtn = document.getElementById("playBtn");
  const reloadBtn = document.getElementById("reloadBtn");
  const capsEl  = document.getElementById("caps");
  const timeTag = document.getElementById("timeTag");

  let currentKey = pickSlot();
  let currentSlot = CFG.slots[currentKey];

  function setError(msg){
    if(!msg){ errEl.style.display="none"; errEl.textContent=""; }
    else { errEl.style.display="block"; errEl.textContent=msg; }
  }

  function apply(){
    currentKey = pickSlot();
    currentSlot = CFG.slots[currentKey];

    titleEl.textContent = CFG.title;
    slotEl.textContent = currentSlot.label;

    animateText(leadEl, currentSlot.message);

    player.pause();
    player.currentTime=0;
    player.src = currentSlot.song;
    playBtn.textContent = "播放";

    renderCaptions(capsEl, currentSlot.captions || []);
    updateActiveCaption(capsEl, currentSlot.captions || [], 0);
    timeTag.textContent = "00:00";

    setError("");
  }

  apply();

  playBtn.addEventListener("click", async ()=>{
    try{
      setError("");
      await player.play();
      playBtn.textContent="播放中";
    }catch(e){
      setError("播放失敗：請確認音檔存在且路徑正確（例如 audio/day_song.mp3）。");
    }
  });

  reloadBtn.addEventListener("click", ()=>apply());

  player.addEventListener("timeupdate", ()=>{
    const t = player.currentTime || 0;
    timeTag.textContent = fmtTime(t);
    const caps = currentSlot.captions || [];
    if(caps.length) updateActiveCaption(capsEl, caps, t);
  });

  /** ====== 兩張圖亂跑：彈跳 + 隨機變速/改方向 ====== */
  const field = document.getElementById("playfield");
  const r1 = document.getElementById("r1");
  const r2 = document.getElementById("r2");

  function makeRunner(el, seed){
    const state = {
      x: 80 + seed*40,
      y: 80 + seed*70,
      vx: (1.3 + Math.random()*1.4) * (Math.random() > .5 ? 1 : -1),
      vy: (1.1 + Math.random()*1.3) * (Math.random() > .5 ? 1 : -1),
      scale: 0.72 + Math.random()*0.10,
      lastSwitch: performance.now(),
      switchEvery: 1500 + Math.random()*1500
    };
    el.style.width = (78 + seed*6) + "px";
    el.style.left = "0px";
    el.style.top  = "0px";
    el.style.transform = `scale(${state.scale})`;

    return {el, state};
  }

  const runners = [makeRunner(r1,1), makeRunner(r2,2)];

  function tick(now){
    const w = window.innerWidth;
    const h = window.innerHeight;

    runners.forEach(({el, state})=>{
      // 偶爾隨機改速度/方向（更「亂跑」）
      if(now - state.lastSwitch > state.switchEvery){
        state.vx += (Math.random()*1.2 - 0.6);
        state.vy += (Math.random()*1.0 - 0.5);

        // 限制最大速度
        state.vx = Math.max(-3.2, Math.min(3.2, state.vx));
        state.vy = Math.max(-3.0, Math.min(3.0, state.vy));

        state.lastSwitch = now;
        state.switchEvery = 1200 + Math.random()*1800;
      }

      state.x += state.vx;
      state.y += state.vy;

      // 邊界碰撞（反彈）
      const rectW = el.getBoundingClientRect().width;
      const rectH = el.getBoundingClientRect().height;

      const maxX = w - rectW - 10;
      const maxY = h - rectH - 10;

      if(state.x < 10){ state.x = 10; state.vx *= -1; }
      if(state.x > maxX){ state.x = maxX; state.vx *= -1; }
      if(state.y < 10){ state.y = 10; state.vy *= -1; }
      if(state.y > maxY){ state.y = maxY; state.vy *= -1; }

      // 方向翻轉（看起來在跑）
      el.classList.toggle("flip", state.vx < 0);

      el.style.transform = `translate3d(${state.x}px, ${state.y}px, 0) scale(${state.scale})`;
    });

    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  // 視窗大小變動時避免卡邊
  window.addEventListener("resize", ()=>{ /* 讓下一幀自行修正 */ });
</script>
</body>
</html>
